<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Monte Carlo Power Evaluation for Experimental Designs — eval_design_mc • skpr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Monte Carlo Power Evaluation for Experimental Designs — eval_design_mc"><meta name="description" content="Evaluates the power of an experimental design, given the run matrix and the
statistical model to be fit to the data, using monte carlo simulation. Simulated data is fit using a
generalized linear model
and power is estimated by the fraction of times a parameter is significant.
Returns a data frame of parameter powers."><meta property="og:description" content="Evaluates the power of an experimental design, given the run matrix and the
statistical model to be fit to the data, using monte carlo simulation. Simulated data is fit using a
generalized linear model
and power is estimated by the fraction of times a parameter is significant.
Returns a data frame of parameter powers."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">skpr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.9.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tylermorganwall/skpr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Monte Carlo Power Evaluation for Experimental Designs</h1>
      <small class="dont-index">Source: <a href="https://github.com/tylermorganwall/skpr/blob/master/R/eval_design_mc.R" class="external-link"><code>R/eval_design_mc.R</code></a></small>
      <div class="d-none name"><code>eval_design_mc.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Evaluates the power of an experimental design, given the run matrix and the
statistical model to be fit to the data, using monte carlo simulation. Simulated data is fit using a
generalized linear model
and power is estimated by the fraction of times a parameter is significant.
Returns a data frame of parameter powers.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">eval_design_mc</span><span class="op">(</span></span>
<span>  <span class="va">design</span>,</span>
<span>  model <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  blocking <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  glmfamily <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>  calceffect <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  effect_anova <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  varianceratios <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  rfunction <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  anticoef <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  firth <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  effectsize <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  contrasts <span class="op">=</span> <span class="va">contr.sum</span>,</span>
<span>  high_resolution_candidate_set <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  moment_sample_density <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  adjust_alpha_inflation <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  detailedoutput <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  advancedoptions <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-design">design<a class="anchor" aria-label="anchor" href="#arg-design"></a></dt>
<dd><p>The experimental design. Internally, <code>eval_design_mc</code> rescales each numeric column
to the range -1 to 1.</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>The model used in evaluating the design. If this is missing and the design
was generated with skpr, the generating model will be used. It can be a subset of the model used to
generate the design, or include higher order effects not in the original design generation. It cannot include
factors that are not present in the experimental design.</p></dd>


<dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>Default <code>0.05</code>. The type-I error. p-values less than this will be counted as significant.</p></dd>


<dt id="arg-blocking">blocking<a class="anchor" aria-label="anchor" href="#arg-blocking"></a></dt>
<dd><p>Default <code>NULL</code>. If <code>TRUE</code>, <code>eval_design_mc</code> will look at the rownames (or blocking columns) to determine blocking structure. Default FALSE.</p></dd>


<dt id="arg-nsim">nsim<a class="anchor" aria-label="anchor" href="#arg-nsim"></a></dt>
<dd><p>Default <code>1000</code>. The number of Monte Carlo simulations to perform.</p></dd>


<dt id="arg-glmfamily">glmfamily<a class="anchor" aria-label="anchor" href="#arg-glmfamily"></a></dt>
<dd><p>Default <code>gaussian</code>. String indicating the family of distribution for the <code>glm</code> function
("gaussian", "binomial", "poisson", or "exponential").</p></dd>


<dt id="arg-calceffect">calceffect<a class="anchor" aria-label="anchor" href="#arg-calceffect"></a></dt>
<dd><p>Default <code>TRUE</code>. Whether to calculate effect power. This calculation is more expensive than parameter power,
so turned off (if not needed) can greatly speed up calculation time.</p></dd>


<dt id="arg-effect-anova">effect_anova<a class="anchor" aria-label="anchor" href="#arg-effect-anova"></a></dt>
<dd><p>Default <code>TRUE</code>, whether to a Type-III Anova or a likelihood ratio test to calculate effect power.
If <code>TRUE</code>, effect power will be calculated using a Type-III Anova (using the car package) and a Wald test. If <code>FALSE</code>,
a likelihood ratio test (using a reduced model for each effect) will performed using the <code>lmtest</code> package. If <code>firth = TRUE</code>,
this will be set to <code>FALSE</code> automatically.</p></dd>


<dt id="arg-varianceratios">varianceratios<a class="anchor" aria-label="anchor" href="#arg-varianceratios"></a></dt>
<dd><p>Default <code>NULL</code>. The ratio of the whole plot variance to the run-to-run variance.
If not specified during design generation, this will default to 1. For designs with more than one subplot
this ratio can be a vector specifying the variance ratio for each subplot (comparing to the run-to-run variance).
Otherwise, it will use a single value for all strata.</p></dd>


<dt id="arg-rfunction">rfunction<a class="anchor" aria-label="anchor" href="#arg-rfunction"></a></dt>
<dd><p>Default <code>NULL</code>.Random number generator function for the response variable. Should be a function of the form f(X, b, delta), where X is the
model matrix, b are the anticipated coefficients, and delta is a vector of blocking errors. Typically something like rnorm(nrow(X), X * b + delta, 1).
You only need to specify this if you do not like the default behavior described below.</p></dd>


<dt id="arg-anticoef">anticoef<a class="anchor" aria-label="anchor" href="#arg-anticoef"></a></dt>
<dd><p>Default <code>NULL</code>.The anticipated coefficients for calculating the power. If missing, coefficients
will be automatically generated based on the <code>effectsize</code> argument.</p></dd>


<dt id="arg-firth">firth<a class="anchor" aria-label="anchor" href="#arg-firth"></a></dt>
<dd><p>Default <code>FALSE</code>. Whether to apply the firth correction (via the <code>mbest</code> package) to a logistic regression. This
setting also automatically sets <code>effect_lr = TRUE</code>.</p></dd>


<dt id="arg-effectsize">effectsize<a class="anchor" aria-label="anchor" href="#arg-effectsize"></a></dt>
<dd><p>Helper argument to generate anticipated coefficients. See details for more info.
If you specify <code>anticoef</code>, <code>effectsize</code> will be ignored.</p></dd>


<dt id="arg-contrasts">contrasts<a class="anchor" aria-label="anchor" href="#arg-contrasts"></a></dt>
<dd><p>Default <code>contr.sum</code>. The contrasts to use for categorical factors. If the user has specified their own contrasts
for a categorical factor using the contrasts function, those will be used. Otherwise, skpr will use contr.sum.
If the user wants to set the number of cores manually, they can do this by setting <code>options("cores")</code> to the desired number (e.g. <code>options("cores" = parallel::detectCores())</code>).
NOTE: If you have installed BLAS libraries that include multicore support (e.g. Intel MKL that comes with Microsoft R Open), turning on parallel could result in reduced performance.</p></dd>


<dt id="arg-high-resolution-candidate-set">high_resolution_candidate_set<a class="anchor" aria-label="anchor" href="#arg-high-resolution-candidate-set"></a></dt>
<dd><p>Default <code>NA</code>. If you have continuous numeric terms and disallowed combinations, the closed-form I-optimality value
cannot be calculated and must be approximated by numeric integration. This requires sampling the allowed space densely, but most candidate sets will provide
a sparse sampling of allowable points. To work around this, skpr will generate a convex hull of the numeric terms for each unique combination of categorical
factors to generate a dense sampling of the space and cache that value internally, but this is a slow calculation and does not support non-convex candidate sets.
To speed up moment matrix calculation,  pass a higher resolution version of your candidate set here with the disallowed combinations already applied.
If you generated your design externally from skpr, there are disallowed combinations in your design, and need correct I-optimalituy values, you must pass your candidate set here.</p></dd>


<dt id="arg-moment-sample-density">moment_sample_density<a class="anchor" aria-label="anchor" href="#arg-moment-sample-density"></a></dt>
<dd><p>Default <code>10</code>. The density of points to sample when calculating the moment matrix to compute I-optimality. Only
required if the design was generated outside of skpr and there are disallowed combinations.</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>Default <code>FALSE</code>. If <code>TRUE</code>, the Monte Carlo power calculation will use all but one of the available cores. If the user wants to set the number of cores manually, they can do this by setting <code>options("cores")</code> to the desired number (e.g. <code>options("cores" = parallel::detectCores())</code>).
NOTE: If you have installed BLAS libraries that include multicore support (e.g. Intel MKL that comes with Microsoft R Open), turning on parallel could result in reduced performance.</p></dd>


<dt id="arg-adjust-alpha-inflation">adjust_alpha_inflation<a class="anchor" aria-label="anchor" href="#arg-adjust-alpha-inflation"></a></dt>
<dd><p>Default <code>FALSE</code>. If <code>TRUE</code>, this will run the simulation twice:
first to calculate the empirical distribution of p-values under the null hypothesis and find
the true Type-I error cutoff that corresponds to the desired Type-I error rate,
and then again given effect size to calculate power values.</p></dd>


<dt id="arg-detailedoutput">detailedoutput<a class="anchor" aria-label="anchor" href="#arg-detailedoutput"></a></dt>
<dd><p>Default <code>FALSE</code>. If <code>TRUE</code>, return additional information about evaluation in results.</p></dd>


<dt id="arg-progress">progress<a class="anchor" aria-label="anchor" href="#arg-progress"></a></dt>
<dd><p>Default <code>TRUE</code>. Whether to include a progress bar.</p></dd>


<dt id="arg-advancedoptions">advancedoptions<a class="anchor" aria-label="anchor" href="#arg-advancedoptions"></a></dt>
<dd><p>Default <code>NULL</code>. Named list of advanced options. <code>advancedoptions$anovatype</code> specifies the Anova type in the car package (default type <code>III</code>),
user can change to type <code>II</code>). <code>advancedoptions$anovatest</code> specifies the test statistic if the user does not want a <code>Wald</code> test–other options are likelyhood-ratio <code>LR</code> and F-test <code>F</code>.
<code>advancedoptions$progressBarUpdater</code> is a function called in non-parallel simulations that can be used to update external progress bar.<code>advancedoptions$GUI</code> turns off some warning messages when in the GUI.
If <code>advancedoptions$save_simulated_responses = TRUE</code>, the dataframe will have an attribute <code>simulated_responses</code> that contains the simulated responses from the power evaluation. <code>advancedoptions$ci_error_conf</code> will
set the confidence level for power intervals, which are printed when <code>detailedoutput = TRUE</code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data frame consisting of the parameters and their powers, with supplementary information
stored in the data frame's attributes. The parameter estimates from the simulations are stored in the "estimates"
attribute. The "model_matrix" attribute contains the model matrix that was used for power evaluation, and
also provides the encoding used for categorical factors. If you want to specify the anticipated
coefficients manually, do so in the order the parameters appear in the model matrix.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Evaluates the power of a design with Monte Carlo simulation. Data is simulated and then fit
with a generalized linear model, and the fraction of simulations in which a parameter
is significant (its p-value, according to the fit function used, is less than the specified <code>alpha</code>)
is the estimate of power for that parameter.</p>
<p>First, if <code>blocking = TURE</code>, the random noise from blocking is generated with <code>rnorm</code>.
Each block gets a single sample of Gaussian random noise, with a variance as specified in
<code>varianceratios</code>,
and that sample is copied to each run in the block. Then, <code>rfunction</code> is called to generate a simulated
response for each run of the design, and the data is fit using the appropriate fitting function.
The functions used to simulate the data and fit it are determined by the <code>glmfamily</code>
and <code>blocking</code> arguments
as follows. Below, X is the model matrix, b is the anticipated coefficients, and d
is a vector of blocking noise (if <code>blocking = FALSE</code> then d = 0):</p>
<table class="table table"><tr><td><b>glmfamily</b></td><td><b>blocking</b></td><td><b>rfunction</b></td><td><b>fit</b></td></tr><tr><td>"gaussian"</td><td>F</td><td><code>rnorm(mean = X %*% b + d, sd = 1)</code></td><td><code>lm</code></td></tr><tr><td>"gaussian"</td><td>T</td><td><code>rnorm(mean = X %*% b + d, sd = 1)</code></td><td><code><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lme4::lmer</a></code></td></tr><tr><td>"binomial"</td><td>F</td><td><code>rbinom(prob = 1/(1+exp(-(X %*% b + d))))</code></td><td><code>glm(family = "binomial")</code></td></tr><tr><td>"binomial"</td><td>T</td><td><code>rbinom(prob = 1/(1+exp(-(X %*% b + d))))</code></td><td><code>lme4::glmer(family = "binomial")</code></td></tr><tr><td>"poisson"</td><td>F</td><td><code>rpois(lambda = exp((X %*% b + d)))</code></td><td><code>glm(family = "poisson")</code></td></tr><tr><td>"poisson"</td><td>T</td><td><code>rpois(lambda = exp((X %*% b + d)))</code></td><td><code>lme4::glmer(family = "poisson")</code></td></tr><tr><td>"exponential"</td><td>F</td><td><code>rexp(rate = exp(-(X %*% b + d)))</code></td><td><code>glm(family = Gamma(link = "log"))</code></td></tr><tr><td>"exponential"</td><td>T</td><td><code>rexp(rate = exp(-(X %*% b + d)))</code></td><td><code>lme4:glmer(family = Gamma(link = "log"))</code></td></tr></table><p>Note that the exponential random generator uses the "rate" parameter, but <code>skpr</code> and <code>glm</code> use
the mean value parameterization (= 1 / rate), hence the minus sign above. Also note that
the gaussian model assumes a root-mean-square error of 1.</p>
<p>Power is dependent on the anticipated coefficients. You can specify those directly with the <code>anticoef</code>
argument, or you can use the <code>effectsize</code> argument to specify an effect size and <code>skpr</code> will auto-generate them.
You can provide either a length-1 or length-2 vector. If you provide a length-1 vector, the anticipated
coefficients will be half of <code>effectsize</code>; this is equivalent to saying that the <em>linear predictor</em>
(for a gaussian model, the mean response; for a binomial model, the log odds ratio; for an exponential model,
the log of the mean value; for a poisson model, the log of the expected response)
changes by <code>effectsize</code> when a continuous factor goes from its lowest level to its highest level. If you provide a
length-2 vector, the anticipated coefficients will be set such that the <em>mean response</em> (for
a gaussian model, the mean response; for a binomial model, the probability; for an exponential model, the mean
response; for a poisson model, the expected response) changes from
<code>effectsize[1]</code> to <code>effectsize[2]</code> when a factor goes from its lowest level to its highest level, assuming
that the other factors are inactive (their x-values are zero).</p>
<p>The effect of a length-2 <code>effectsize</code> depends on the <code>glmfamily</code> argument as follows:</p>
<p>For <code>glmfamily = 'gaussian'</code>, the coefficients are set to <code>(effectsize[2] - effectsize[1]) / 2</code>.</p>
<p>For <code>glmfamily = 'binomial'</code>, the intercept will be
<code>1/2 * log(effectsize[1] * effectsize[2] / (1 - effectsize[1]) / (1 - effectsize[2]))</code>,
and the other coefficients will be
<code>1/2 * log(effectsize[2] * (1 - effectsize[1]) / (1 - effectsize[2]) / effectsize[1])</code>.</p>
<p>For <code>glmfamily = 'exponential'</code> or <code>'poisson'</code>,
the intercept will be
<code>1 / 2 * (log(effectsize[2]) + log(effectsize[1]))</code>,
and the other coefficients will be
<code>1 / 2 * (log(effectsize[2]) - log(effectsize[1]))</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">#We first generate a full factorial design using expand.grid:</span></span></span>
<span class="r-in"><span><span class="va">factorialcoffee</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>cost <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                              type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Kona"</span>, <span class="st">"Colombian"</span>, <span class="st">"Ethiopian"</span>, <span class="st">"Sumatra"</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                              size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Short"</span>, <span class="st">"Grande"</span>, <span class="st">"Venti"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu">skpr</span><span class="fu">:::</span><span class="fu"><a href="run_documentation.html">run_documentation</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">#And then generate the 21-run D-optimal design using gen_design.</span></span></span>
<span class="r-in"><span><span class="va">designcoffee</span> <span class="op">=</span> <span class="fu"><a href="gen_design.html">gen_design</a></span><span class="op">(</span><span class="va">factorialcoffee</span>,</span></span>
<span class="r-in"><span>                         model <span class="op">=</span> <span class="op">~</span><span class="va">cost</span> <span class="op">+</span> <span class="va">type</span> <span class="op">+</span> <span class="va">size</span>, trials <span class="op">=</span> <span class="fl">21</span>, optimality <span class="op">=</span> <span class="st">"D"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu">skpr</span><span class="fu">:::</span><span class="fu"><a href="run_documentation.html">run_documentation</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">#To evaluate this design using a normal approximation, we just use eval_design</span></span></span>
<span class="r-in"><span><span class="co">#(here using the default settings for contrasts, effectsize, and the anticipated coefficients):</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="eval_design.html">eval_design</a></span><span class="op">(</span>design <span class="op">=</span> <span class="va">designcoffee</span>, model <span class="op">=</span> <span class="op">~</span><span class="va">cost</span> <span class="op">+</span> <span class="va">type</span> <span class="op">+</span> <span class="va">size</span>, <span class="fl">0.05</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      parameter            type     power</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  (Intercept)    effect.power 0.9871086</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         cost    effect.power 0.9871086</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3         type    effect.power 0.9239395</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4         size    effect.power 0.8484877</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  (Intercept) parameter.power 0.9871086</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6         cost parameter.power 0.9871086</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7        type1 parameter.power 0.6652414</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8        type2 parameter.power 0.6652414</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9        type3 parameter.power 0.6652414</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10       size1 parameter.power 0.8434093</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11       size2 parameter.power 0.8434093</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ============Evaluation Info=============</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Alpha = </span>0.05 <span style="font-weight: bold;">• Trials = </span>21 <span style="font-weight: bold;">• Blocked = </span>FALSE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Evaluating Model = </span>~cost + type + size </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Anticipated Coefficients = </span>c(1, 1, 1, -1, 1, 1, -1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Contrasts = </span>`contr.sum` </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Parameter Analysis Method = </span>`lm(...)` </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Effect Analysis Method = </span>`car::Anova(fit, type = "III")` </span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu">skpr</span><span class="fu">:::</span><span class="fu"><a href="run_documentation.html">run_documentation</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">#To evaluate this design with a Monte Carlo method, we enter the same information</span></span></span>
<span class="r-in"><span><span class="co">#used in eval_design, with the addition of the number of simulations "nsim" and the distribution</span></span></span>
<span class="r-in"><span><span class="co">#family used in fitting for the glm "glmfamily". For gaussian, binomial, exponential, and poisson</span></span></span>
<span class="r-in"><span><span class="co">#families, a default random generating function (rfunction) will be supplied. If another glm</span></span></span>
<span class="r-in"><span><span class="co">#family is used or the default random generating function is not adequate, a custom generating</span></span></span>
<span class="r-in"><span><span class="co">#function can be supplied by the user. Like in `eval_design()`, if the model isn't entered, the</span></span></span>
<span class="r-in"><span><span class="co">#model used in generating the design will be used.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">eval_design_mc</span><span class="op">(</span><span class="va">designcoffee</span>, nsim <span class="op">=</span> <span class="fl">100</span>, glmfamily <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      parameter               type power</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  (Intercept)    effect.power.mc  0.98</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         cost    effect.power.mc  1.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3         type    effect.power.mc  0.93</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4         size    effect.power.mc  0.82</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  (Intercept) parameter.power.mc  0.98</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6         cost parameter.power.mc  1.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7        type1 parameter.power.mc  0.66</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8        type2 parameter.power.mc  0.68</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9        type3 parameter.power.mc  0.66</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10       size1 parameter.power.mc  0.79</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11       size2 parameter.power.mc  0.85</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ============Evaluation Info============</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Alpha = </span>0.05 <span style="font-weight: bold;">• Trials = </span>21 <span style="font-weight: bold;">• Blocked = </span>FALSE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Evaluating Model = </span>~cost + type + size </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Anticipated Coefficients = </span>c(1, 1, 1, -1, 1, 1, -1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Contrasts = </span>`contr.sum` </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Parameter Analysis Method = </span>`lm(...)` </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Effect Analysis Method = </span>`car::Anova(fit, type = "III")` </span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu">skpr</span><span class="fu">:::</span><span class="fu"><a href="run_documentation.html">run_documentation</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">#We can also add error bars on the Monte Carlo power values by setting</span></span></span>
<span class="r-in"><span><span class="co">#`detailedoutput = TRUE` (which will print out other information as well).</span></span></span>
<span class="r-in"><span><span class="co">#We can set the confidence via the `advancedoptions` argument.</span></span></span>
<span class="r-in"><span><span class="fu">eval_design_mc</span><span class="op">(</span><span class="va">designcoffee</span>, nsim <span class="op">=</span> <span class="fl">100</span>, glmfamily <span class="op">=</span> <span class="st">"gaussian"</span>,</span></span>
<span class="r-in"><span>              detailedoutput <span class="op">=</span> <span class="cn">TRUE</span>, advancedoptions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ci_error_conf  <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      parameter               type power anticoef alpha glmfamily trials nsim</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  (Intercept)    effect.power.mc  1.00       NA  0.05  gaussian     21  100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         cost    effect.power.mc  1.00       NA  0.05  gaussian     21  100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3         type    effect.power.mc  0.96       NA  0.05  gaussian     21  100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4         size    effect.power.mc  0.84       NA  0.05  gaussian     21  100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  (Intercept) parameter.power.mc  1.00        1  0.05  gaussian     21  100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6         cost parameter.power.mc  1.00        1  0.05  gaussian     21  100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7        type1 parameter.power.mc  0.66        1  0.05  gaussian     21  100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8        type2 parameter.power.mc  0.73       -1  0.05  gaussian     21  100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9        type3 parameter.power.mc  0.76        1  0.05  gaussian     21  100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10       size1 parameter.power.mc  0.85        1  0.05  gaussian     21  100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11       size2 parameter.power.mc  0.87       -1  0.05  gaussian     21  100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    blocking error_adjusted_alpha power_lcb power_ucb</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     FALSE                 0.05 0.9772372 1.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     FALSE                 0.05 0.9772372 1.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     FALSE                 0.05 0.9216525 0.9824411</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4     FALSE                 0.05 0.7828449 0.8863619</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5     FALSE                 0.05 0.9772372 1.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6     FALSE                 0.05 0.9772372 1.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7     FALSE                 0.05 0.5922582 0.7227847</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8     FALSE                 0.05 0.6649082 0.7879254</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9     FALSE                 0.05 0.6965555 0.8153148</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10    FALSE                 0.05 0.7938706 0.8949874</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11    FALSE                 0.05 0.8161255 0.9120174</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =======================================================Evaluation Info========================================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Alpha = </span>0.05 <span style="font-weight: bold;">• Trials = </span>21 <span style="font-weight: bold;">• Blocked = </span>FALSE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Evaluating Model = </span>~cost + type + size </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Anticipated Coefficients = </span>c(1, 1, 1, -1, 1, 1, -1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Contrasts = </span>`contr.sum` </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Parameter Analysis Method = </span>`lm(...)` </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Effect Analysis Method = </span>`car::Anova(fit, type = "III")` </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• MC Power CI Confidence = </span>80% </span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu">skpr</span><span class="fu">:::</span><span class="fu"><a href="run_documentation.html">run_documentation</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">#We see here we generate approximately the same parameter powers as we do</span></span></span>
<span class="r-in"><span><span class="co">#using the normal approximation in eval_design. Like eval_design, we can also change</span></span></span>
<span class="r-in"><span><span class="co">#effectsize to produce a different signal-to-noise ratio:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">eval_design_mc</span><span class="op">(</span>design <span class="op">=</span> <span class="va">designcoffee</span>, nsim <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>                       glmfamily <span class="op">=</span> <span class="st">"gaussian"</span>, effectsize <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      parameter               type power</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  (Intercept)    effect.power.mc  0.58</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         cost    effect.power.mc  0.56</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3         type    effect.power.mc  0.35</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4         size    effect.power.mc  0.30</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  (Intercept) parameter.power.mc  0.58</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6         cost parameter.power.mc  0.56</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7        type1 parameter.power.mc  0.25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8        type2 parameter.power.mc  0.19</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9        type3 parameter.power.mc  0.18</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10       size1 parameter.power.mc  0.33</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11       size2 parameter.power.mc  0.32</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ============Evaluation Info============</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Alpha = </span>0.05 <span style="font-weight: bold;">• Trials = </span>21 <span style="font-weight: bold;">• Blocked = </span>FALSE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Evaluating Model = </span>~cost + type + size </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Anticipated Coefficients = </span>c(0.500, 0.500, 0.500, -0.500, 0.500, 0.500, -0.500) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Contrasts = </span>`contr.sum` </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Parameter Analysis Method = </span>`lm(...)` </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Effect Analysis Method = </span>`car::Anova(fit, type = "III")` </span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu">skpr</span><span class="fu">:::</span><span class="fu"><a href="run_documentation.html">run_documentation</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">#Like eval_design, we can also evaluate the design with a different model than</span></span></span>
<span class="r-in"><span><span class="co">#the one that generated the design.</span></span></span>
<span class="r-in"><span><span class="fu">eval_design_mc</span><span class="op">(</span>design <span class="op">=</span> <span class="va">designcoffee</span>, model <span class="op">=</span> <span class="op">~</span><span class="va">cost</span> <span class="op">+</span> <span class="va">type</span>, alpha <span class="op">=</span> <span class="fl">0.05</span>,</span></span>
<span class="r-in"><span>              nsim <span class="op">=</span> <span class="fl">100</span>, glmfamily <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     parameter               type power</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 (Intercept)    effect.power.mc  0.98</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        cost    effect.power.mc  1.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3        type    effect.power.mc  0.95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 (Intercept) parameter.power.mc  0.98</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5        cost parameter.power.mc  1.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6       type1 parameter.power.mc  0.68</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7       type2 parameter.power.mc  0.69</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8       type3 parameter.power.mc  0.69</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ===========Evaluation Info============</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Alpha = </span>0.05 <span style="font-weight: bold;">• Trials = </span>21 <span style="font-weight: bold;">• Blocked = </span>FALSE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Evaluating Model = </span>~cost + type </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Anticipated Coefficients = </span>c(1, 1, 1, -1, 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Contrasts = </span>`contr.sum` </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Parameter Analysis Method = </span>`lm(...)` </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Effect Analysis Method = </span>`car::Anova(fit, type = "III")` </span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu">skpr</span><span class="fu">:::</span><span class="fu"><a href="run_documentation.html">run_documentation</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">#And here it is evaluated with additional interactions included:</span></span></span>
<span class="r-in"><span><span class="fu">eval_design_mc</span><span class="op">(</span>design <span class="op">=</span> <span class="va">designcoffee</span>, model <span class="op">=</span> <span class="op">~</span><span class="va">cost</span> <span class="op">+</span> <span class="va">type</span> <span class="op">+</span> <span class="va">size</span> <span class="op">+</span> <span class="va">cost</span> <span class="op">*</span> <span class="va">type</span>, <span class="fl">0.05</span>,</span></span>
<span class="r-in"><span>              nsim <span class="op">=</span> <span class="fl">100</span>, glmfamily <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      parameter               type power</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  (Intercept)    effect.power.mc  0.99</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         cost    effect.power.mc  0.99</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3         type    effect.power.mc  0.88</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4         size    effect.power.mc  0.82</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5    cost:type    effect.power.mc  0.90</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  (Intercept) parameter.power.mc  0.99</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7         cost parameter.power.mc  0.99</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8        type1 parameter.power.mc  0.66</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9        type2 parameter.power.mc  0.53</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10       type3 parameter.power.mc  0.60</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11       size1 parameter.power.mc  0.79</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12       size2 parameter.power.mc  0.82</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13  cost:type1 parameter.power.mc  0.65</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14  cost:type2 parameter.power.mc  0.63</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15  cost:type3 parameter.power.mc  0.63</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ============Evaluation Info============</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Alpha = </span>0.05 <span style="font-weight: bold;">• Trials = </span>21 <span style="font-weight: bold;">• Blocked = </span>FALSE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Evaluating Model = </span>~cost + type + size + cost * type </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Anticipated Coefficients = </span>c(1, 1, 1, -1, 1, 1, -1, 1, -1, 1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Contrasts = </span>`contr.sum` </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Parameter Analysis Method = </span>`lm(...)` </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Effect Analysis Method = </span>`car::Anova(fit, type = "III")` </span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu">skpr</span><span class="fu">:::</span><span class="fu"><a href="run_documentation.html">run_documentation</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">#We can also set "parallel = TRUE" to use all the cores available to speed up</span></span></span>
<span class="r-in"><span><span class="co">#computation.</span></span></span>
<span class="r-in"><span><span class="fu">eval_design_mc</span><span class="op">(</span>design <span class="op">=</span> <span class="va">designcoffee</span>, nsim <span class="op">=</span> <span class="fl">10000</span>,</span></span>
<span class="r-in"><span>                       glmfamily <span class="op">=</span> <span class="st">"gaussian"</span>, parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using user-defined {future} plan() `plan(sequential)` instead of {skpr}'s default multicore plan (for this computer) of `plan("multicore", workers = number_of_cores-1)`</span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in globalCallingHandlers(condition = global_progression_handler):</span> should not be called with handlers on the stack</span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu">skpr</span><span class="fu">:::</span><span class="fu"><a href="run_documentation.html">run_documentation</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">#We can also evaluate split-plot designs. First, let us generate the split-plot design:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">factorialcoffee2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>Temp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                               Store <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                               cost <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                               type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Kona"</span>, <span class="st">"Colombian"</span>, <span class="st">"Ethiopian"</span>, <span class="st">"Sumatra"</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                               size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Short"</span>, <span class="st">"Grande"</span>, <span class="st">"Venti"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">vhtcdesign</span> <span class="op">=</span> <span class="fu"><a href="gen_design.html">gen_design</a></span><span class="op">(</span><span class="va">factorialcoffee2</span>,</span></span>
<span class="r-in"><span>                       model <span class="op">=</span> <span class="op">~</span><span class="va">Store</span>, trials <span class="op">=</span> <span class="fl">6</span>, varianceratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">htcdesign</span> <span class="op">=</span> <span class="fu"><a href="gen_design.html">gen_design</a></span><span class="op">(</span><span class="va">factorialcoffee2</span>, model <span class="op">=</span> <span class="op">~</span><span class="va">Store</span> <span class="op">+</span> <span class="va">Temp</span>, trials <span class="op">=</span> <span class="fl">18</span>,</span></span>
<span class="r-in"><span>                       splitplotdesign <span class="op">=</span> <span class="va">vhtcdesign</span>, blocksizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">6</span><span class="op">)</span>, varianceratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">splitplotdesign</span> <span class="op">=</span> <span class="fu"><a href="gen_design.html">gen_design</a></span><span class="op">(</span><span class="va">factorialcoffee2</span>,</span></span>
<span class="r-in"><span>                            model <span class="op">=</span> <span class="op">~</span><span class="va">Store</span> <span class="op">+</span> <span class="va">Temp</span> <span class="op">+</span> <span class="va">cost</span> <span class="op">+</span> <span class="va">type</span> <span class="op">+</span> <span class="va">size</span>, trials <span class="op">=</span> <span class="fl">54</span>,</span></span>
<span class="r-in"><span>                            splitplotdesign <span class="op">=</span> <span class="va">htcdesign</span>, blocksizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">18</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            varianceratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Each block has an additional noise term associated with it in addition to the normal error</span></span></span>
<span class="r-in"><span><span class="co">#term in the model. This is specified by a vector specifying the additional variance for</span></span></span>
<span class="r-in"><span><span class="co">#each split-plot level. This is equivalent to specifying a variance ratio of one between</span></span></span>
<span class="r-in"><span><span class="co">#the whole plots and the run-to-run variance for gaussian models.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Evaluate the design. Note the decreased power for the blocking factors.</span></span></span>
<span class="r-in"><span><span class="fu">eval_design_mc</span><span class="op">(</span><span class="va">splitplotdesign</span>, blocking <span class="op">=</span> <span class="cn">TRUE</span>, nsim <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>                       glmfamily <span class="op">=</span> <span class="st">"gaussian"</span>, varianceratios <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      parameter               type power</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        Store    effect.power.mc  0.33</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         Temp    effect.power.mc  0.89</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3         cost    effect.power.mc  1.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4         type    effect.power.mc  1.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5         size    effect.power.mc  1.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  (Intercept) parameter.power.mc  0.33</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7       Store1 parameter.power.mc  0.33</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8         Temp parameter.power.mc  0.89</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9         cost parameter.power.mc  1.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10       type1 parameter.power.mc  0.98</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11       type2 parameter.power.mc  0.98</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12       type3 parameter.power.mc  0.98</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13       size1 parameter.power.mc  1.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14       size2 parameter.power.mc  1.00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ============Evaluation Info============</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Alpha = </span>0.05 <span style="font-weight: bold;">• Trials = </span>54 <span style="font-weight: bold;">• Blocked = </span>TRUE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Evaluating Model = </span>~Store + Temp + cost + type + size </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Anticipated Coefficients = </span>c(1, 1, 1, 1, 1, -1, 1, 1, -1) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Number of Blocks = </span>Level :  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Variance Ratios  = </span>Level 1: 1, Level 2: 1, Level 3: 1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Contrasts = </span>`contr.sum` </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Parameter Analysis Method = </span>`lmerTest::lmer(...)` </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Effect Analysis Method = </span>`car::Anova(fit, type = "III")` </span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu">skpr</span><span class="fu">:::</span><span class="fu"><a href="run_documentation.html">run_documentation</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">#We can also use this method to evaluate designs that cannot be easily</span></span></span>
<span class="r-in"><span><span class="co">#evaluated using normal approximations. Here, we evaluate a design with a binomial response and see</span></span></span>
<span class="r-in"><span><span class="co">#whether we can detect the difference between each factor changing whether an event occurs</span></span></span>
<span class="r-in"><span><span class="co">#70% of the time or 90% of the time.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">factorialbinom</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">designbinom</span> <span class="op">=</span> <span class="fu"><a href="gen_design.html">gen_design</a></span><span class="op">(</span><span class="va">factorialbinom</span>, model <span class="op">=</span> <span class="op">~</span><span class="va">a</span> <span class="op">+</span> <span class="va">b</span>, trials <span class="op">=</span> <span class="fl">90</span>, optimality <span class="op">=</span> <span class="st">"D"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">eval_design_mc</span><span class="op">(</span><span class="va">designbinom</span>, <span class="op">~</span><span class="va">a</span> <span class="op">+</span> <span class="va">b</span>, alpha <span class="op">=</span> <span class="fl">0.2</span>, nsim <span class="op">=</span> <span class="fl">100</span>, effectsize <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">0.9</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>              glmfamily <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     parameter               type power</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 (Intercept)    effect.power.mc  0.98</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           a    effect.power.mc  0.88</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           b    effect.power.mc  0.79</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 (Intercept) parameter.power.mc  0.98</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5           a parameter.power.mc  0.88</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6           b parameter.power.mc  0.79</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ===========Evaluation Info============</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Alpha = </span>0.2 <span style="font-weight: bold;">• Trials = </span>90 <span style="font-weight: bold;">• Blocked = </span>FALSE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Evaluating Model = </span>~a + b </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Anticipated Coefficients = </span>c(1.522, 0.675, 0.675) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Contrasts = </span>`contr.sum` </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Parameter Analysis Method = </span>glm(..., family = "binomial")` </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Effect Analysis Method = </span>`car::Anova(fit, type = "III")` </span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu">skpr</span><span class="fu">:::</span><span class="fu"><a href="run_documentation.html">run_documentation</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">#We can also use this method to determine power for poisson response variables.</span></span></span>
<span class="r-in"><span><span class="co">#Generate the design:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">factorialpois</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">designpois</span> <span class="op">=</span> <span class="fu"><a href="gen_design.html">gen_design</a></span><span class="op">(</span><span class="va">factorialpois</span>, <span class="op">~</span><span class="va">a</span> <span class="op">+</span> <span class="va">b</span>, trials <span class="op">=</span> <span class="fl">70</span>, optimality <span class="op">=</span> <span class="st">"D"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Evaluate the power:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">eval_design_mc</span><span class="op">(</span><span class="va">designpois</span>, <span class="op">~</span><span class="va">a</span> <span class="op">+</span> <span class="va">b</span>, <span class="fl">0.05</span>, nsim <span class="op">=</span> <span class="fl">100</span>, glmfamily <span class="op">=</span> <span class="st">"poisson"</span>,</span></span>
<span class="r-in"><span>               anticoef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     parameter               type power</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 (Intercept)    effect.power.mc  0.95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           a    effect.power.mc  0.79</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           b    effect.power.mc  0.79</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 (Intercept) parameter.power.mc  0.95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5           a parameter.power.mc  0.79</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6           b parameter.power.mc  0.79</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ===========Evaluation Info============</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Alpha = </span>0.05 <span style="font-weight: bold;">• Trials = </span>70 <span style="font-weight: bold;">• Blocked = </span>FALSE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Evaluating Model = </span>~a + b </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Anticipated Coefficients = </span>c(-1.609, 0.693, 0.693) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Contrasts = </span>`contr.sum` </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Parameter Analysis Method = </span>`glm(..., family = "poisson")` </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Effect Analysis Method = </span>`car::Anova(fit, type = "III")` </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#The coefficients above set the nominal value -- that is, the expected count</span></span></span>
<span class="r-in"><span><span class="co">#when all inputs = 0 -- to 0.2 (from the intercept), and say that each factor</span></span></span>
<span class="r-in"><span><span class="co">#changes this count by a factor of 4 (multiplied by 2 when x= +1, and divided by 2 when x = -1).</span></span></span>
<span class="r-in"><span><span class="co">#Note the use of log() in the anticipated coefficients.</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tyler Morgan-Wall, George Khoury.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

