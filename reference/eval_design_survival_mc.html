<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Evaluate Power for Survival Design — eval_design_survival_mc • skpr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Evaluate Power for Survival Design — eval_design_survival_mc"><meta name="description" content="Evaluates power for an experimental design in which the response variable may be
right- or left-censored. Power is evaluated with a Monte Carlo simulation,
using the survival package and survreg to fit the data. Split-plot designs are not supported."><meta property="og:description" content="Evaluates power for an experimental design in which the response variable may be
right- or left-censored. Power is evaluated with a Monte Carlo simulation,
using the survival package and survreg to fit the data. Split-plot designs are not supported."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">skpr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.7.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tylermorganwall/skpr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Evaluate Power for Survival Design</h1>
      <small class="dont-index">Source: <a href="https://github.com/tylermorganwall/skpr/blob/master/R/eval_design_survival_mc.R" class="external-link"><code>R/eval_design_survival_mc.R</code></a></small>
      <div class="d-none name"><code>eval_design_survival_mc.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Evaluates power for an experimental design in which the response variable may be
right- or left-censored. Power is evaluated with a Monte Carlo simulation,
using the <code>survival</code> package and <code>survreg</code> to fit the data. Split-plot designs are not supported.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">eval_design_survival_mc</span><span class="op">(</span></span>
<span>  <span class="va">design</span>,</span>
<span>  model <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  distribution <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>  censorpoint <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  censortype <span class="op">=</span> <span class="st">"right"</span>,</span>
<span>  rfunctionsurv <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  anticoef <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  effectsize <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  contrasts <span class="op">=</span> <span class="va">contr.sum</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  detailedoutput <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  advancedoptions <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-design">design<a class="anchor" aria-label="anchor" href="#arg-design"></a></dt>
<dd><p>The experimental design. Internally, all numeric columns will be rescaled to [-1, +1].</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>The model used in evaluating the design. If this is missing and the design
was generated with skpr, the generating model will be used. It can be a subset of the model used to
generate the design, or include higher order effects not in the original design generation. It cannot include
factors that are not present in the experimental design.</p></dd>


<dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>Default `0.05`. The type-I error. p-values less than this will be counted as significant.</p></dd>


<dt id="arg-nsim">nsim<a class="anchor" aria-label="anchor" href="#arg-nsim"></a></dt>
<dd><p>The number of simulations. Default 1000.</p></dd>


<dt id="arg-distribution">distribution<a class="anchor" aria-label="anchor" href="#arg-distribution"></a></dt>
<dd><p>Distribution of survival function to use when fitting the data. Valid choices are described
in the documentation for <code>survreg</code>. <em>Supported</em> options are
"exponential", "lognormal", or "gaussian". Default "gaussian".</p></dd>


<dt id="arg-censorpoint">censorpoint<a class="anchor" aria-label="anchor" href="#arg-censorpoint"></a></dt>
<dd><p>The point after/before (for right-censored or left-censored data, respectively)
which data should be labelled as censored. Default NA for no censoring. This argument is
used only by the internal random number generators; if you supply your own function to
the <code>rfunctionsurv</code> parameter, then this parameter will be ignored.</p></dd>


<dt id="arg-censortype">censortype<a class="anchor" aria-label="anchor" href="#arg-censortype"></a></dt>
<dd><p>The type of censoring (either "left" or "right"). Default "right".</p></dd>


<dt id="arg-rfunctionsurv">rfunctionsurv<a class="anchor" aria-label="anchor" href="#arg-rfunctionsurv"></a></dt>
<dd><p>Random number generator function. Should be a function of the form f(X, b), where X is the
model matrix and b are the anticipated coefficients. This function should return a <code>Surv</code> object from
the <code>survival</code> package. You do not need to provide this argument if <code>distribution</code> is one of
the supported choices and you are satisfied with the default behavior described below.</p></dd>


<dt id="arg-anticoef">anticoef<a class="anchor" aria-label="anchor" href="#arg-anticoef"></a></dt>
<dd><p>The anticipated coefficients for calculating the power. If missing, coefficients
will be automatically generated based on the <code>effectsize</code> argument.</p></dd>


<dt id="arg-effectsize">effectsize<a class="anchor" aria-label="anchor" href="#arg-effectsize"></a></dt>
<dd><p>Helper argument to generate anticipated coefficients. See details for more info.
If you specify <code>anticoef</code>, <code>effectsize</code> will be ignored.</p></dd>


<dt id="arg-contrasts">contrasts<a class="anchor" aria-label="anchor" href="#arg-contrasts"></a></dt>
<dd><p>Default <code>contr.sum</code>. Function used to encode categorical variables in the model matrix. If the user has specified their own contrasts
for a categorical factor using the contrasts function, those will be used. Otherwise, skpr will use contr.sum.</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>Default `FALSE`. If `TRUE`, the power simulation will use all but one of the available cores.
If the user wants to set the number of cores manually, they can do this by setting `options("cores")` to the desired number (e.g. `options("cores" = parallel::detectCores())`).
NOTE: If you have installed BLAS libraries that include multicore support (e.g. Intel MKL that comes with Microsoft R Open), turning on parallel could result in reduced performance.</p></dd>


<dt id="arg-detailedoutput">detailedoutput<a class="anchor" aria-label="anchor" href="#arg-detailedoutput"></a></dt>
<dd><p>Default `FALSE`. If `TRUE`, return additional information about evaluation in results.</p></dd>


<dt id="arg-progress">progress<a class="anchor" aria-label="anchor" href="#arg-progress"></a></dt>
<dd><p>Default `TRUE`. Whether to include a progress bar.</p></dd>


<dt id="arg-advancedoptions">advancedoptions<a class="anchor" aria-label="anchor" href="#arg-advancedoptions"></a></dt>
<dd><p>Default `NULL`. Named list of advanced options. Pass `progressBarUpdater` to include function called in non-parallel simulations that can be used to update external progress bar.
`advancedoptions$ci_error_conf` will set the confidence level for power intervals, which are printed when `detailedoutput = TRUE`.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Any additional arguments to be passed into the <code>survreg</code> function during fitting.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data frame consisting of the parameters and their powers. The parameter estimates from the simulations are
stored in the 'estimates' attribute. The 'modelmatrix' attribute contains the model matrix and the encoding used for
categorical factors. If you manually specify anticipated coefficients, do so in the order of the model matrix.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Evaluates the power of a design with Monte Carlo simulation. Data is simulated and then fit
with a survival model (<code><a href="https://rdrr.io/pkg/survival/man/survreg.html" class="external-link">survival::survreg</a></code>), and the fraction of simulations in which a parameter
is significant
(its p-value is less than the specified <code>alpha</code>)
is the estimate of power for that parameter.</p>
<p>If not supplied by the user, <code>rfunctionsurv</code> will be generated based on the <code>distribution</code>
argument as follows:</p><table class="table table"><tr><td><b>distribution</b></td><td><b>generating function</b></td></tr><tr><td>"gaussian"</td><td><code>rnorm(mean = X %*% b, sd = 1)</code></td></tr><tr><td>"exponential"</td><td><code>rexp(rate = exp(-X %*% b))</code></td></tr><tr><td>"lognormal"</td><td><code>rlnorm(meanlog = X %*% b, sdlog = 1)</code></td></tr></table><p>In each case, if a simulated data point is past the censorpoint (greater than for right-censored, less than for
left-censored) it is marked as censored. See the examples below for how to construct your own function.</p>

<p>Power is dependent on the anticipated coefficients. You can specify those directly with the <code>anticoef</code>
argument, or you can use the <code>effectsize</code> argument to specify an effect size and <code>skpr</code> will auto-generate them.
You can provide either a length-1 or length-2 vector. If you provide a length-1 vector, the anticipated
coefficients will be half of <code>effectsize</code>; this is equivalent to saying that the <em>linear predictor</em>
(for a gaussian model, the mean response; for an exponential model or lognormal model,
the log of the mean value)
changes by <code>effectsize</code> when a continuous factor goes from its lowest level to its highest level. If you provide a
length-2 vector, the anticipated coefficients will be set such that the <em>mean response</em> changes from
<code>effectsize[1]</code> to <code>effectsize[2]</code> when a factor goes from its lowest level to its highest level, assuming
that the other factors are inactive (their x-values are zero).</p>
<p>The effect of a length-2 <code>effectsize</code> depends on the <code>distribution</code> argument as follows:</p>
<p>For <code>distribution = 'gaussian'</code>, the coefficients are set to <code>(effectsize[2] - effectsize[1]) / 2</code>.</p>
<p>For <code>distribution = 'exponential'</code> or <code>'lognormal'</code>,
the intercept will be
<code>1 / 2 * (log(effectsize[2]) + log(effectsize[1]))</code>,
and the other coefficients will be
<code>1 / 2 * (log(effectsize[2]) - log(effectsize[1]))</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">#These examples focus on the survival analysis case and assume familiarity</span></span></span>
<span class="r-in"><span><span class="co">#with the basic functionality of eval_design_mc.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#We first generate a simple 2-level design using expand.grid:</span></span></span>
<span class="r-in"><span><span class="va">basicdesign</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">design</span> <span class="op">=</span> <span class="fu"><a href="gen_design.html">gen_design</a></span><span class="op">(</span>candidateset <span class="op">=</span> <span class="va">basicdesign</span>, model <span class="op">=</span> <span class="op">~</span><span class="va">a</span>, trials <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#We can then evaluate the power of the design in the same way as eval_design_mc,</span></span></span>
<span class="r-in"><span><span class="co">#now including the type of censoring (either right or left) and the point at which</span></span></span>
<span class="r-in"><span><span class="co">#the data should be censored:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">eval_design_survival_mc</span><span class="op">(</span>design <span class="op">=</span> <span class="va">design</span>, model <span class="op">=</span> <span class="op">~</span><span class="va">a</span>, alpha <span class="op">=</span> <span class="fl">0.05</span>,</span></span>
<span class="r-in"><span>                        nsim <span class="op">=</span> <span class="fl">100</span>, distribution <span class="op">=</span> <span class="st">"exponential"</span>,</span></span>
<span class="r-in"><span>                        censorpoint <span class="op">=</span> <span class="fl">5</span>, censortype <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>default or length 1 delta used with distribution == 'exponential'. This can lead to unrealistic effect sizes - make sure the generated anticipated coeffcients are appropriate.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     parameter               type power</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 (Intercept) parameter.power.mc  0.91</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           a parameter.power.mc  0.89</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ===========Evaluation Info============</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Alpha = </span>0.05 <span style="font-weight: bold;">• Trials = </span>15 <span style="font-weight: bold;">• Blocked = </span>FALSE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Evaluating Model = </span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Anticipated Coefficients = </span>c(1, 1) </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Built-in Monte Carlo random generating functions are included for the gaussian, exponential,</span></span></span>
<span class="r-in"><span><span class="co">#and lognormal distributions.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#We can also evaluate different censored distributions by specifying a custom</span></span></span>
<span class="r-in"><span><span class="co">#random generating function and changing the distribution argument.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">rlognorm</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span>, <span class="va">b</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">Y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, meanlog <span class="op">=</span> <span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">b</span>, sdlog <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">censored</span> <span class="op">=</span> <span class="va">Y</span> <span class="op">&gt;</span> <span class="fl">1.2</span></span></span>
<span class="r-in"><span>  <span class="va">Y</span><span class="op">[</span><span class="va">censored</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1.2</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">survival</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span>time <span class="op">=</span> <span class="va">Y</span>, event <span class="op">=</span> <span class="op">!</span><span class="va">censored</span>, type <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Any additional arguments are passed into the survreg function call.  As an example, you</span></span></span>
<span class="r-in"><span><span class="co">#might want to fix the "scale" argument to survreg, when fitting a lognormal:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">eval_design_survival_mc</span><span class="op">(</span>design <span class="op">=</span> <span class="va">design</span>, model <span class="op">=</span> <span class="op">~</span><span class="va">a</span>, alpha <span class="op">=</span> <span class="fl">0.2</span>, nsim <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>                        distribution <span class="op">=</span> <span class="st">"lognormal"</span>, rfunctionsurv <span class="op">=</span> <span class="va">rlognorm</span>,</span></span>
<span class="r-in"><span>                        anticoef <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.184</span>, <span class="fl">0.101</span><span class="op">)</span>, scale <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     parameter               type power</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 (Intercept) parameter.power.mc  0.51</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           a parameter.power.mc  0.40</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ===========Evaluation Info============</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Alpha = </span>0.2 <span style="font-weight: bold;">• Trials = </span>15 <span style="font-weight: bold;">• Blocked = </span>FALSE </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Evaluating Model = </span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="font-weight: bold;">• Anticipated Coefficients = </span>c(0.184, 0.101) </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tyler Morgan-Wall, George Khoury.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

